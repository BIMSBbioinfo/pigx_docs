
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>PiGx BS-seq Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="pigx-bs-seq.html" />
    
    
    <link rel="prev" href="pigx-chip-seq.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="pigx-rna-seq.html">
            
                <a href="pigx-rna-seq.html">
            
                    
                    PiGx RNA-seq
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="pigx-rna-seq.html">
            
                <a href="pigx-rna-seq.html#introduction">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="pigx-rna-seq.html">
            
                <a href="pigx-rna-seq.html#preparation">
            
                    
                    Preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="pigx-rna-seq.html">
            
                <a href="pigx-rna-seq.html#execution">
            
                    
                    Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="pigx-rna-seq.html">
            
                <a href="pigx-rna-seq.html#results">
            
                    
                    Results
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="pigx-rna-seq.html">
            
                <a href="pigx-rna-seq.html#troubleshooting">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="pigx-chip-seq.html">
            
                <a href="pigx-chip-seq.html">
            
                    
                    PiGx ChIP-seq
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="pigx-chip-seq.html">
            
                <a href="pigx-chip-seq.html#introduction">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="pigx-chip-seq.html">
            
                <a href="pigx-chip-seq.html#install">
            
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="pigx-chip-seq.html">
            
                <a href="pigx-chip-seq.html#dependencies">
            
                    
                    Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="pigx-chip-seq.html">
            
                <a href="pigx-chip-seq.html#getting-started">
            
                    
                    Getting started
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="pigx-bs-seq.html">
            
                <a href="pigx-bs-seq.html">
            
                    
                    PiGx BS-seq
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="pigx-bs-seq.html">
            
                <a href="pigx-bs-seq.html#introduction">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="pigx-bs-seq.html">
            
                <a href="pigx-bs-seq.html#the-workflow">
            
                    
                    Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="pigx-bs-seq.html">
            
                <a href="pigx-bs-seq.html#input-preparation">
            
                    
                    Input preparation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="pigx-bs-seq.html">
            
                <a href="pigx-bs-seq.html#execution">
            
                    
                    Execution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="pigx-bs-seq.html">
            
                <a href="pigx-bs-seq.html#analysis">
            
                    
                    Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="pigx-bs-seq.html">
            
                <a href="pigx-bs-seq.html#troubleshooting">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html">
            
                    
                    PiGx scRNA-seq
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#introduction">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#install">
            
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#dependencies">
            
                    
                    Dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#getting-started">
            
                    
                    Getting started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#the-input-parameters">
            
                    
                    Input parameters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#resource-considerations">
            
                    
                    Resource considerations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#output-directory-structure">
            
                    
                    Output directory structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#downstream-analysis">
            
                    
                    Downstream analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="pigx-scrna-seq.html">
            
                <a href="pigx-scrna-seq.html#example">
            
                    
                    Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >PiGx BS-seq</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="pigx-bs-seq">PiGx BS-seq</h1>
<h2 id="introduction">Introduction</h2>
<p>PiGx-bsseq is a preprocessing and analysis pipeline that takes raw <code>fastq</code> read files and performs all necessary steps to present the full methylome for analysis. Quality control, and differential methylation are also performed, and a final report provides a summary for each sample provided by the user.</p>
<h2 id="the-workflow">The workflow</h2>
<p>This figure provides an overview of the various stages of the
pipeline, as well as the outputs and expected inputs.</p>
<p><img src="figures/pigx-bsseq.svg" alt="PiGx BSseq workflow"></p>
<p>In addition to fastq read files, a necessary input to the pipeline is
a reference genome to be mapped to.  If such a genome has not already
undergone bisulfite conversion, such a conversion can be prepared
automatically by PiGx.  At the same time, reads are trimmed for
quality and adapter sequences using
<a href="http://www.bioinformatics.babraham.ac.uk/projects/trim_galore/" target="_blank">TrimGalore!</a>,
with quality control analysis applied both before and after.  Once
these steps are completed, reads can then be mapped to the genome
using
<a href="http://www.bioinformatics.babraham.ac.uk/projects/bismark/" target="_blank">Bismark</a>,
before alignments are filtered for duplication and sorted.
Methylation-calling is then carried out using
<a href="https://github.com/al2na/methylKit/Methylkit" target="_blank">MethylKit</a> before
initial post-mapping analysis such as segmentation and differential
methylation between samples.</p>
<h2 id="input-preparation">Input preparation</h2>
<p>To use the pipeline, the user must first edit two files: the sample sheet and the settings file. </p>
<h3 id="sample-sheet-xls---csv">Sample Sheet (<code>.xls</code> -&gt; <code>.csv</code>)</h3>
<p>The sample sheet is a tabular file (<code>csv</code> format) describing the experiment.
The table has the following columns:</p>
<table>
<thead>
<tr>
<th>reads</th>
<th>reads(2)</th>
<th>sample_ID</th>
<th>protocol</th>
<th>treatment</th>
</tr>
</thead>
<tbody>
<tr>
<td>SA_R1.fastq.gz</td>
<td>SA_R2.fastq.gz</td>
<td>sample_A</td>
<td>WGBS</td>
<td>0</td>
</tr>
<tr>
<td>SB.fastq.gz</td>
<td></td>
<td>sample_B</td>
<td>WGBS</td>
<td>1</td>
</tr>
<tr>
<td>...</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Here, each row of entries (below the header) corresponds to a sample. In this
example, <code>sample A</code> is a paired-end experiment with two <code>fastq</code> files, whereas
<code>sample B</code> is single end; thus, the <code>read 2</code> column for the latter is left blank.
The third column, <code>sample ID</code>, contains some descriptive name (without
white spaces) for the sample. The fourth column refers to the experimantal
protocol (e.g. &quot;WGBS&quot; / &quot;RRBS&quot; for whole-genome/reduced-representation
bisulfite sequencing, respectively), while the 5th column contains a treatment
label--generally an integer-- that is used for reference in differential
methylation (see below).</p>
<p>The above sample sheet can be produced by editing the included file
<code>test/sample_sheet.xls</code> and saving it in <code>.csv</code> format with fields separated by
commas (<code>,</code>).</p>
<h3 id="settings-file-yaml">Settings File (<code>.yaml</code>)</h3>
<p>In the settings file, various parameters are saved, in YAML format, to configure the execution of PiGx-bsseq. 
The entries are stored hierarchically, and a brief description is provided below, along with possible default value in parenthesis:</p>
<ul>
<li><p><code>locations</code>: </p>
<ul>
<li><code>input-dir</code>: path to directory containing the input <code>fastq</code> files (./in)</li>
<li><code>output-dir</code>: path to desired output directory, which PiGx will create if necessary (./out)</li>
<li><code>genome-dir</code>: path to directory containing the reference genome. (./genome)</li>
</ul>
</li>
<li><p>general:</p>
<ul>
<li><code>assembly</code>: reference genome name (&apos;hg19&apos;) </li>
<li>methylation-calling:<ul>
<li><code>minimum-coverage</code>: minimum number of read-hits required for inclusion in analysis (10).</li>
<li><code>minimum-quality</code>:  minimum read quality required for mapping (10)</li>
</ul>
</li>
<li>differential-methylation:<ul>
<li><code>cores</code>: number of cpu threads for differential methylation (1)</li>
<li><code>treatment-groups</code>: a series of pairings specifying comparisons to be performed between samples, based on the treatment vector supplied in the sample sheet (no default, but an example compatible with the above sample sheet is provided in the following line). The index of the control group <em>must</em> be provided first, followed by the treatment being studied. Final report output represents the status of the latter index, relative to the former.<ul>
<li>[&apos;0&apos;, &apos;1&apos;]</li>
</ul>
</li>
</ul>
</li>
<li>annotation:<ul>
<li><code>CpGfile</code>:  file (with path) specifying CpG annotations for differential methylation (genome/cpgIslandExt.hg19.bed.gz).</li>
<li><code>refGenfile</code>: file (with path) specifying reference genes for differential methylation (genome/refGene.hg19.bed.gz).</li>
<li><code>webfetch</code>: Boolean instruction as to whether PiGx should attempt to fetch the above files from the internet if they are unavailable locally (no).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The values stored in the settings input file are used to overwrite the default
settings, described below. An example settings file is available in
the <code>test/</code> directory as <code>settings.yaml</code>. 
The fields in <code>locations</code>, for example, will almost certainly require user input
to over-write the default locations.</p>
<p>Note in particular the field <code>differential-methylation</code>:<code>treatment-groups</code>; below
this there may be arbitrarily lines in the format <code>- [&apos;A&apos;, &apos;B&apos;]</code> where <code>A</code> and
<code>B</code> are integers referring to the treatment values from the sample sheet. Each
such line represents a command to carry-out pair-wise comparison between the
samples with the corresponding treatment values <code>A</code> and <code>B</code>. i</p>
<p>The remaining fields provided here (and in the example settings file)
 comprise most of the settings that a
typical user might want to access, while the more basic settings that are saved
as defaults in <code>etc/settings.yaml.in</code> will not need to be modified by most
users (although advanced users may freely re-define any such variables in their own
settings file, and by so doing, overwrite them).</p>
<h2 id="execution">Execution</h2>
<p>After editting the above input files, the bsseq pipeline can be executed with
the command: <code>./pigx-bsseq [sample sheet] -s [settings file]</code> with further
options, described in the README (for example, the flag <code>--dry-run</code> can be
added to confirm valid input settings before execution).  Once the pipeline is
executed, the desired output directory is created, along with various
sub-directories for intermediate steps in the process, each of which are named
with prefixes to indicate their (approximate) order in sequence.  In most
cases, these processes have their own interim reports and log files. For
example, <code>06_sorting</code> contains the sorted <code>.bam</code> file after alignments, and
<code>07_methyl_calls</code> contains information on average methylation in various
formats, while <code>01_raw_QC</code> is the earliest step --quality control of the raw
inputs. </p>
<h2 id="analysis">Analysis</h2>
<p>In the <code>out-dir</code> folder, PiGx will create a sub-directory
<code>Final_Reports/</code> in which a final report for each sample is provided, along
with a report on the differential methylation observations for each pair of
samples that was provided in the sample sheet under <code>general:
differential-methylation: treatment-groups:</code> Further analysis can be performed
on the aligned data using the sorted <code>.bam</code> file in <code>06_sorting</code>, or the bigwig
file in <code>08_bigwig_files</code>, although for simple methylation percentages, it
should be suffice to consult the column-separated files in <code>07_methyl_calls</code>.
In each case, the specific file names will refer to the sample IDs provided in
the original sample sheet.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>The dependency graph of rules contains branches; as such, the rules are not
always performed in <em>exactly</em> the order indicated by directory prefix labels.
Nevertheless, in cases of interrupted calculation, it may be useful to inspect
the log files from the last (or second-to-last) directory created to check for
error messages. </p>
<p>Alongside these directories, the directory <code>pigx_work</code> is also created, with
its contents described in the file <code>CONTENTS</code>---here one can see links to the
original data files for traceability. In case a run of PiGx was done a long
time ago, under conditions that have been forgotten, the subfolder
<code>pigx_work/input/</code> contains links to each of the raw data files,
<code>pigx_work/refGenome</code> links to the reference genome that was mapped do during
exection, and <code>pigx_work/bin</code> contains links to the versions of binary
executables that were used in the process.</p>
<h3 id="cluster-submission">Cluster Submission</h3>
<p>The settings file allows for fields that will serve to optimize resource usage
when PiGx is submitted to a cluster via SGE (Sun Grid Engine, a standard
queueing system). For example, under the section <code>execution: rules:</code> various
parameters can be supplied regarding resource consumption (e.g. number of
threads, memory required, etc.) for each rule individually, or, alternatively,
<code>execution: cluster: queue</code> can specify a single queue for all jobs. </p>
<p>The default parameters were chosen and tested on the human hg19 genome, since
it is larger (and therefore requires a larger RAM footprint) than most other
model organisms (e.g. Drosophila, mouse, etc.).  This is not an exhaustive
test, however, and it remains possible that PiGx users studying exotic genomes
may yet exceed resource allowance. In such cases, a job execution will be
aborted and an email will be sent to the address supplied by the user detailing
circumstances of the failed job (such as start time, stop time, <code>Max vmem</code> =
maximum memory consumed), and resource requests can be adjusted accordingly.
Advanced users may consult <code>etc/settings.yaml.in</code> to see which values can be
fine-tuned; novice users who are studying either the human genome, or a smaller
one, should simply ignore this section and allow PiGx to assign the default
values.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="pigx-chip-seq.html#getting-started" class="navigation navigation-prev " aria-label="Previous page: Getting started">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="pigx-bs-seq.html#introduction" class="navigation navigation-next " aria-label="Next page: Introduction">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"PiGx BS-seq","level":"1.4","depth":1,"next":{"title":"Introduction","level":"1.4.1","depth":2,"anchor":"#introduction","path":"pigx-bs-seq.md","ref":"pigx-bs-seq.md#introduction","articles":[]},"previous":{"title":"Getting started","level":"1.3.4","depth":2,"anchor":"#getting-started","path":"pigx-chip-seq.md","ref":"pigx-chip-seq.md#getting-started","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"pigx-bs-seq.md","mtime":"2018-04-10T10:48:50.157Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-04-10T10:50:14.029Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

